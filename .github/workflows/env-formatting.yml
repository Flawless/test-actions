name: testing dynamic vars

on:
  workflow_dispatch:
    inputs:
      destination:
        required: true
        type: choice
        description: Where to deploy
        default: 'stage'
        options:
        - stage
        - prod

jobs:
  check-release:
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.result }}
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Find Tag
      id: tagger
      uses: digital-ai/query-tag-action@v2
      with:
        include: 'v*'
        exclude: '*-rc*'
        commit-ish: 'HEAD'
        exact-match: 'true'
    - name: export status
      id: check
      run: echo "result=${{ !steps.tagger.outputs.tag == 'NO_TAGS' }}" >> $GITHUB_OUTPUT
    - name: Show out
      run: |
        echo 'Output from Find Tag: ${{ steps.tagger.outputs.tag }}'
        echo 'Output from check: ${{ steps.check.outputs.result }}'

  wtf:
    runs-on: ubuntu-latest
    needs: check-release
    if: ${{ (needs.check-release.outputs.result || github.event.inputs.destination != 'prod') }}
    steps:
    - name: hello
      run: echo ${{ github.event.inputs.destination }}
    - name: dst
      run: echo ${{ env.DST }}
